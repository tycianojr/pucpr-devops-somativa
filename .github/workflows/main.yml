name: Auto approve and merge PRs in Queries Folder

# Trigger the workflow on pull request
on:
  pull_request:
    # Sequence of patterns matched against refs/heads
    branches:    
      - 'main'

jobs:

  changes:
    runs-on: ubuntu-latest
    # Required permissions
    permissions:
      pull-requests: read
    # Set job outputs to values from filter step
    outputs:
      apps: ${{ steps.filter.outputs.apps }}
      scripts: ${{ steps.filter.outputs.scripts }}
      github: ${{ steps.filter.outputs.github }}
    steps:
    # For pull requests it's not necessary to checkout the code
    - uses: dorny/paths-filter@v2
      id: filter
      with:
        filters: |
          apps:
            - 'apps/**'
          scripts:
            - 'scripts/**'
          github:
            - '.github/**'
            
  autoapprove:
    needs: changes
    if: ${{ needs.changes.outputs.apps == 'false' && needs.changes.outputs.scripts == 'false' && needs.changes.outputs.github == 'false'}}
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - uses: hmarr/auto-approve-action@v3
